
```{r setup, include = FALSE}
library(tidyverse)
library(targets)
library(tarchetypes)
library(readr)
library(tufte)
library(dotwhisker)
library(ggpubr)
library(scales)
library(mlogit)
library(patchwork)
source("R/table_maker.R")
```

# Methods

For our research, the population input corresponds to individuals in the Salt Lake City, Utah, US Region. The activity-based model used to generate the microsimulation input data is ActivitySim @activitysim. The microsimulation tool used to generate travel behavior data is BEAM @beam.

ActivitySim implements a multifaceted mode choice model that is dependent on trip, tour, and purpose. One model determines the primary mode for each tour and a separate model determines the mode for each trip. In addition, each modal decision is dependent on the current tour purpose value. Contrastingly, BEAM's default mode choice structure uses a simple multinomial logit model as its predictor. 

In our study, ActivitySim's tour-based mode choice model was coded into the BEAM framework. Mode choice decisions were based on tour purposes. In addition, ActivitySim's path, person, and location utility parameter values were added to BEAM's Multinomial Logit function. 

BEAM was then run using five different mode choice models. These five models are described below. 

  1. BEAM's default multinomial logit function with default parameters
  2. ActivitySim's purpose dependent multinomial logit function using only path-type parameters
  3. ActivitySim's purpose dependent multinomial logit function using only person-type parameters 
  4. ActivitySim's purpose dependent multinomial logit function using only location-type parameters
  5. ActivitySim's purpose dependent multinomial logit function using all available parameters

## Data

The data analyzed in our study includes the events files generated by BEAM for each BEAM structure. The events file stores all the decisions made by all individuals during the simulation, including their mode choice decisions. The events files generated from each version of BEAM (the 5 versions explained above) were compared with each other.

The variables of interest that were analyzed from the events files include the following:

  - Person ID
  - Trip ID
  - Tour Index
  - Tour Purpose
  - Mode Chosen
  - Vehicle Ownership
  - Income

## Models

A different multinomial logit function exists for each version of BEAM that was run. Instead of writing out the lengthy equation that exists for each version, a table of utility parameters and their values are provided for each model. The following tables (Table 1 through Table 4) provide this information.


```{r, echo = FALSE}
tar_read(mnltable)
```

(I haven't decided yet if I want to put in tables of values here of multinomial logit functions or neither. The tables are really long, but easier to understand whereas the functions are shorter but have a million variables and are harder to understand.)



